---
title: 磁盘
weight: 7
---

## 磁盘管理

- `fdisk`：管“**盘**”的（物理/虚拟磁盘）；
- `df`：管“**分区**”的（已挂载的文件系统）；
- `du`：管“**文件**”的（目录和文件的大小）。

### fdisk 

查看磁盘，磁盘分区。（`parted -l` 和 `fdisk -l` 类似）。
操作对象是磁盘本身（如 `/dev/sda`），而不是分区（如 `/dev/sda1）`。

- `-l` (最常用)	列出指定磁盘的分区表，例如 `fdisk -l /dev/sda`。不指定磁盘设备则列出所有磁盘，例如 `fdisk -l`。

#### 交互模式

```bash
# 为新添加的硬盘创建分区

fdisk /dev/sdb # 进入交互模式

# 进入交互模式后，常用流程：
# 1. 输入 `n` 创建新分区
# 2. 选择主分区/扩展分区 (p/e)
# 3. 设置分区号 (1-4)
# 4. 设置起始扇区（直接回车用默认值）
# 5. 设置结束扇区或大小（如 +10G）
# 6. 输入 `p` 预览分区表
# 7. 确认无误后输入 `w` 保存并退出


# 修改分区类型
fdisk /dev/sdb
# 输入 `t`，然后选择分区号，最后输入分区类型的十六进制代码（如 LVM 是 `8e`，Swap 是 `82`）
```

### df 

用于查看已挂载的文件系统的整体磁盘空间使用情况。操作对象是文件系统。

- `-h`：(最常用)	以人类易读格式显示（G, M, K）。
- `-T`：显示文件系统类型（如 ext4, xfs, tmpfs）。
- `-i`：显示 inode 使用情况 而非块使用情况。
- `-t <类型>`：只显示指定类型的文件系统，例如 `df -t xfs`，只显示 XFS 类型。
- `-x <类型>`：排除指定类型的文件系统。

```bash
# 排查 "No space left on device" 错误
# 情况1：磁盘空间满了
df -h

# 情况2：磁盘空间没满，但 inode 用完了（常见于有大量小文件的系统）
df -hi

# 只查看本地磁盘，排除临时文件系统（如 tmpfs）
df -hT -x tmpfs -x devtmpfs
```

### du 

du (disk usage) 用于**查看具体文件或目录占用了多少磁盘空间**。**操作对象是文件/目录**。

显示的实际占用的空间，默认单位是 KB。`ls -l` 查看的文件大小包含了部分空洞的空间。

- `-h`：(最常用)	以人类易读格式显示。
- `-s`：只显示总用量摘要，不显示子目录详情。
- `-c`：除了显示大小，最后再显示一个总计。
- `--max-depth=N`：显示到第 N 级子目录的深度。


```bash
# 定位磁盘空间被谁占用了（df 发现满之后的下一步）
# 1. 先查看根目录下哪个一级目录最大
du -sh --max-depth=1 /

# 2. 发现是 /var 很大，再深入查看 /var 下哪个子目录最大
du -sh --max-depth=1 /var

# 3. 发现是 /var/log 很大，继续深入...
du -sh --max-depth=1 /var/log



# 查看某个特定目录的总大小
du -sh /home/wwwroot


# 查找并清理大文件或旧文件
# 结合 sort 和 head 命令找出 /var/log 下最大的10个文件或目录
du -h /var/log | sort -rh | head -10
```